// Traduzioni disponibili
const translations = {
    it: {
        // Login
        "loginTitle": "Accesso Operaio",
        "selectOperaio": "Seleziona il tuo nome:",
        "insertPin": "Inserisci il tuo PIN:",
        "pinPlaceholder": "PIN di 4 cifre",
        "loginButton": "Accedi",
        // Registrazione ore
        "registerHoursTitle": "Registra Ore Lavorative",
        "dataLabel": "Data:",
        "cantiereLabel": "Cantiere:",
        "selectCantiere": "Seleziona cantiere...",
        "oreLabel": "Ore Lavorate:",
        "oreStradaLabel": "Ore di Strada:",
        "straordinarioLabel": "Straordinario:",
        "noteLabel": "Note (opzionale):",
        "registerButtonText": "Registra Ore",
        // Riepilogo
        "summaryTitle": "Riepilogo Settimanale",
        "dataTableHeader": "Data",
        "cantiereTableHeader": "Cantiere",
        "oreTableHeader": "Ore",
        "oreStradaTableHeader": "Strada",
        "straordinarioTableHeader": "Straord.",
        "totaleTableHeader": "Totale",
        "noRecentRegistrations": "Nessuna registrazione recente",
        // Altro
        "logoutButton": "Esci",
        "offlineMessage": "Sei offline. I dati verranno sincronizzati quando tornerai online.",
        "hoursRegisteredSuccess": "Ore registrate con successo!",
        "invalidCredentials": "Credenziali non valide",
        "selectOperaioAndPin": "Seleziona un operaio e inserisci il PIN",
        "operaioNotFound": "Operaio non trovato",
        "invalidPin": "PIN non valido"
    },
    ar: {
        // Login
        "loginTitle": "تسجيل دخول العامل",
        "selectOperaio": "حدد اسمك:",
        "insertPin": "أدخل رمز التعريف الشخصي الخاص بك:",
        "pinPlaceholder": "رمز التعريف المكون من 4 أرقام",
        "loginButton": "تسجيل الدخول",
        // Registrazione ore
        "registerHoursTitle": "تسجيل ساعات العمل",
        "dataLabel": "التاريخ:",
        "cantiereLabel": "موقع العمل:",
        "selectCantiere": "اختر موقع العمل...",
        "oreLabel": "ساعات العمل:",
        "oreStradaLabel": "ساعات السفر:",
        "straordinarioLabel": "الساعات الإضافية:",
        "noteLabel": "ملاحظات (اختياري):",
        "registerButtonText": "تسجيل الساعات",
        // Riepilogo
        "summaryTitle": "ملخص الأسبوع",
        "dataTableHeader": "التاريخ",
        "cantiereTableHeader": "موقع العمل",
        "oreTableHeader": "الساعات",
        "oreStradaTableHeader": "السفر",
        "straordinarioTableHeader": "إضافي",
        "totaleTableHeader": "المجموع",
        "noRecentRegistrations": "لا توجد تسجيلات حديثة",
        // Altro
        "logoutButton": "تسجيل خروج",
        "offlineMessage": "أنت غير متصل بالإنترنت. سيتم مزامنة البيانات عند عودة الاتصال.",
        "hoursRegisteredSuccess": "تم تسجيل الساعات بنجاح!",
        "invalidCredentials": "بيانات الاعتماد غير صالحة",
        "selectOperaioAndPin": "الرجاء اختيار اسمك وإدخال الرمز الشخصي",
        "operaioNotFound": "لم يتم العثور على العامل",
        "invalidPin": "رمز التعريف غير صالح"
    },
    ro: {
        // Login
        "loginTitle": "Acces Muncitor",
        "selectOperaio": "Selectați numele dvs.:",
        "insertPin": "Introduceți PIN-ul dvs.:",
        "pinPlaceholder": "PIN din 4 cifre",
        "loginButton": "Autentificare",
        // Registrazione ore
        "registerHoursTitle": "Înregistrare Ore de Lucru",
        "dataLabel": "Data:",
        "cantiereLabel": "Șantier:",
        "selectCantiere": "Selectați șantierul...",
        "oreLabel": "Ore Lucrate:",
        "oreStradaLabel": "Ore de Drum:",
        "straordinarioLabel": "Ore Suplimentare:",
        "noteLabel": "Note (opțional):",
        "registerButtonText": "Înregistrare Ore",
        // Riepilogo
        "summaryTitle": "Rezumat Săptămânal",
        "dataTableHeader": "Data",
        "cantiereTableHeader": "Șantier",
        "oreTableHeader": "Ore",
        "oreStradaTableHeader": "Drum",
        "straordinarioTableHeader": "Suplim.",
        "totaleTableHeader": "Total",
        "noRecentRegistrations": "Nicio înregistrare recentă",
        // Altro
        "logoutButton": "Ieșire",
        "offlineMessage": "Sunteți offline. Datele vor fi sincronizate când reveniți online.",
        "hoursRegisteredSuccess": "Ore înregistrate cu succes!",
        "invalidCredentials": "Credențiale invalide",
        "selectOperaioAndPin": "Selectați un muncitor și introduceți PIN-ul",
        "operaioNotFound": "Muncitor negăsit",
        "invalidPin": "PIN invalid"
    },
    sq: {
        // Login
        "loginTitle": "Hyrja e Punëtorit",
        "selectOperaio": "Zgjidh emrin tënd:",
        "insertPin": "Vendos PIN-in tënd:",
        "pinPlaceholder": "PIN me 4 shifra",
        "loginButton": "Hyrje",
        // Registrazione ore
        "registerHoursTitle": "Regjistro Orët e Punës",
        "dataLabel": "Data:",
        "cantiereLabel": "Kantieri:",
        "selectCantiere": "Zgjidh kantierin...",
        "oreLabel": "Orë Pune:",
        "oreStradaLabel": "Orë Rruge:",
        "straordinarioLabel": "Orë Shtesë:",
        "noteLabel": "Shënime (opsionale):",
        "registerButtonText": "Regjistro Orët",
        // Riepilogo
        "summaryTitle": "Përmbledhje Javore",
        "dataTableHeader": "Data",
        "cantiereTableHeader": "Kantieri",
        "oreTableHeader": "Orët",
        "oreStradaTableHeader": "Rruga",
        "straordinarioTableHeader": "Shtesë",
        "totaleTableHeader": "Totali",
        "noRecentRegistrations": "Asnjë regjistrim i kohëve të fundit",
        // Altro
        "logoutButton": "Dilni",
        "offlineMessage": "Jeni offline. Të dhënat do të sinkronizohen kur të jeni përsëri online.",
        "hoursRegisteredSuccess": "Orët u regjistruan me sukses!",
        "invalidCredentials": "Kredenciale të pavlefshme",
        "selectOperaioAndPin": "Zgjidh një punëtor dhe vendos PIN-in",
        "operaioNotFound": "Punëtori nuk u gjet",
        "invalidPin": "PIN i pavlefshëm"
    }
};

// Lingua corrente (default: italiano)
let currentLanguage = localStorage.getItem('appLanguage') || 'it';

// Funzione per tradurre l'interfaccia
function translateUI() {
    console.log("Traduzione UI in:", currentLanguage);
    const elementsToTranslate = document.querySelectorAll('[data-i18n]');
    const currentTranslations = translations[currentLanguage];
    
    // Aggiorna il testo visualizzato della lingua corrente
    document.getElementById('currentLanguage').textContent = 
        currentLanguage === 'it' ? 'Italiano' : 
        currentLanguage === 'ar' ? 'العربية' : 
        currentLanguage === 'ro' ? 'Română' : 'Shqip';
    
    // Se la lingua è araba, aggiungi la classe RTL al body
    if (currentLanguage === 'ar') {
        document.body.classList.add('rtl');
    } else {
        document.body.classList.remove('rtl');
    }
    
    // Traduzione elementi
    elementsToTranslate.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (currentTranslations[key]) {
            // Controlla se l'elemento è un placeholder di input
            if (element.hasAttribute('placeholder')) {
                element.setAttribute('placeholder', currentTranslations[key]);
            } else {
                element.textContent = currentTranslations[key];
            }
        }
    });
    
    console.log("Traduzione completata, elementi tradotti:", elementsToTranslate.length);
}

// Imposta lingua e traduci UI
function setLanguage(langCode) {
    currentLanguage = langCode;
    localStorage.setItem('appLanguage', langCode);
    translateUI();
}

// Inizializza la traduzione quando il documento è pronto
document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM caricato, inizializzazione traduzioni...");
    
    // Imposta lingua iniziale
    setLanguage(currentLanguage);
    
    // Gestione dei clic sulle opzioni della lingua
    document.querySelectorAll('.dropdown-item[data-lang]').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            console.log("Cambio lingua a:", this.getAttribute('data-lang'));
            setLanguage(this.getAttribute('data-lang'));
        });
    });
});

// Funzione per ottenere una traduzione
function getMessage(key) {
    return translations[currentLanguage][key] || translations['it'][key] || key;
}